## ğŸ“¦ Ferramenta de SincronizaÃ§Ã£o de Dados (Parquet Converter)

Este script (parquet_converter.py) Ã© responsÃ¡vel por gerenciar o ciclo de vida dos dados dos YouTubers coletados. Ele atua como uma ponte entre a estrutura de pastas legÃ­vel por humanos (CSV/JSON locais) e o arquivo otimizado para armazenamento/versionamento (Parquet).

Esta ferramenta garante a integridade dos tipos de dados (evitando que IDs virem nÃºmeros e cortem zeros Ã  esquerda) e resolve problemas de compatibilidade entre bibliotecas (Pandas, Numpy e JSON).

## ğŸš€ InstalaÃ§Ã£o e DependÃªncias

Para executar este script, vocÃª precisa do Python 3.10+ e das bibliotecas listadas abaixo.

### Instalar dependÃªncias

Execute o comando no terminal:

```
pip install pandas numpy rich pyarrow fastparquet
```

+ pandas & numpy: ManipulaÃ§Ã£o de dados.
+ rich: Logs coloridos e formatados no terminal.
+ pyarrow: Motor para leitura/escrita de arquivos Parquet.

## ğŸ“‚ Estrutura de Pastas Esperada

O script assume que o projeto segue a seguinte estrutura:

```
projeto/
â”‚
â”œâ”€â”€ parquet_converter.py   # O script principal
â”‚
â”œâ”€â”€ files/                 # ONDE FICAM AS PASTAS LOCAIS (CSV/JSON)
â”‚   â”œâ”€â”€ jazzghost/
â”‚   â”‚   â”œâ”€â”€ channel_info.csv
â”‚   â”‚   â”œâ”€â”€ 2024/
â”‚   â”‚   â”‚   â””â”€â”€ Janeiro/
â”‚   â”‚   â”‚       â””â”€â”€ Titulo_Video/
â”‚   â”‚   â”‚           â”œâ”€â”€ videos_info.csv
â”‚   â”‚   â”‚           â”œâ”€â”€ tiras_video.csv
â”‚   â”‚   â”‚           â””â”€â”€ video_text.json
â”‚   â””â”€â”€ authenticgames/
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ data/                  # ONDE FICAM OS ARQUIVOS PARQUET (COMPACTADOS)
    â”œâ”€â”€ jazzghost.parquet
    â””â”€â”€ authenticgames.parquet
```

## ğŸ› ï¸ Como Usar

A sintaxe bÃ¡sica do comando Ã©:

```
python parquet_converter.py [ACAO] [ALVO]
```

+ **[ACAO]**: encode, decode ou diff.

+ **[ALVO]**: O nome da pasta do youtuber (ex: jazzghost) ou all para processar todos.

## ğŸ“– CenÃ¡rios de Uso (Passo a Passo)

### CenÃ¡rio 1: "Acabei de rodar o coletor ou editei arquivos manualmente" (ENCODE)

VocÃª baixou novos vÃ­deos ou corrigiu uma transcriÃ§Ã£o manualmente na pasta files/ e precisa salvar isso no arquivo Parquet para nÃ£o perder.

**O que o cÃ³digo faz**: LÃª a pasta files/, limpa os tipos de dados e salva em data/{youtuber}.parquet.

```
# Para um youtuber especÃ­fico
python parquet_converter.py encode "Julia MineGirl"

# Para todos os youtubers (Batch)
python parquet_converter.py encode all
```

**Nota**: Se o arquivo Parquet jÃ¡ existir, ele farÃ¡ um "Merge", atualizando apenas os vÃ­deos novos ou modificados e mantendo o histÃ³rico antigo.

### CenÃ¡rio 2: "Baixei atualizaÃ§Ãµes do Git/DVC e preciso ver os arquivos" (DECODE)

VocÃª fez um git pull ou dvc pull e recebeu um arquivo .parquet novo, mas precisa ver os JSONs e CSVs na pasta para anÃ¡lise humana.

**O que o cÃ³digo faz**: LÃª o arquivo data/{youtuber}.parquet e recria toda a Ã¡rvore de pastas em files/.

```
# Para um youtuber especÃ­fico
python parquet_converter.py decode "Julia MineGirl"

# Para todos os youtubers
python parquet_converter.py decode all
```

**Nota**: Isso sobrescreverÃ¡ os arquivos locais com a versÃ£o que estÃ¡ no Parquet.

### CenÃ¡rio 3: "Quero saber se estÃ¡ tudo sincronizado" (DIFF)

Antes de fazer Encode ou Decode, vocÃª quer saber se hÃ¡ diferenÃ§as entre o que estÃ¡ na sua pasta e o que estÃ¡ salvo no arquivo.

**O que o cÃ³digo faz**: Compara os IDs dos vÃ­deos na pasta local vs. arquivo Parquet.

```
python parquet_converter.py diff "Julia MineGirl"
```

SaÃ­da esperada:

+ ğŸŸ¢ **Sincronizado**: Tudo igual.
+ ğŸŸ¡ **Novos Locais**: VocÃª tem vÃ­deos na pasta que ainda nÃ£o foram salvos no Parquet (Requer Encode).
+ ğŸ”´ **Faltando Local**: O Parquet tem vÃ­deos que vocÃª nÃ£o tem na pasta (Requer Decode).

## âš™ï¸ Detalhes TÃ©cnicos (Para Desenvolvedores)

### Tratamento de Tipos (SanitizaÃ§Ã£o)

Um dos maiores problemas em CSVs Ã© que IDs como "00123" sÃ£o lidos como o nÃºmero 123. Este script possui uma funÃ§Ã£o de SanitizaÃ§Ã£o Inteligente:

+ **HeranÃ§a**: Se jÃ¡ existe um Parquet, ele forÃ§a os novos dados a seguirem os tipos antigos.
+ **ProteÃ§Ã£o de IDs**: Colunas terminadas em _id sÃ£o forÃ§adas como String.
+ **InferÃªncia**: Tenta converter colunas numÃ©ricas e booleanas automaticamente.
+ **Fallback**: Se tudo falhar, converte para String para evitar erro fatal (PyArrow Crash).

### NumpyEncoder

O Pandas frequentemente usa tipos do Numpy (int64, float32) que a biblioteca json padrÃ£o do Python nÃ£o consegue salvar. O script utiliza uma classe personalizada NumpyEncoder para converter esses tipos nativamente durante a geraÃ§Ã£o dos arquivos JSON no processo de Decode.

## âš ï¸ SoluÃ§Ã£o de Problemas Comuns

### Erro: "ArrowInvalid: ... conversion failed"

Isso significa que uma coluna tem dados misturados (ex: nÃºmero e texto).

**SoluÃ§Ã£o**: O script tentarÃ¡ corrigir automaticamente usando a funÃ§Ã£o sanitizar_dataframe_generico. Se falhar, ele entrarÃ¡ em Modo de EmergÃªncia e salvarÃ¡ tudo como texto para garantir que os dados nÃ£o sejam perdidos.

### Erro: "Arquivo nÃ£o encontrado" no Decode

Verifique se o arquivo .parquet existe na pasta data/. Se vocÃª usa DVC, lembre-se de rodar dvc pull antes.